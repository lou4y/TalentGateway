<!-- Step-by-step form with corrected structure -->
<div class="container-fluid" style="margin-top:50px;">
  <button type="button" (click)="onCancel()" class="close-btn" style="display: flex; justify-content: flex-end;margin-left:1100px;">
    <i class="fas fa-times" style="color:red; font-size: 1.3em;"></i>
  </button>
  <div class="row">
    <div class="col-lg-12">
      <div class="card">
        <div class="card-body">
          <div id="basic-example">
            <ng-stepper #cdkStepper [linear]="true" class="wizard">

              <!-- Step 1: Project Information -->
              <cdk-step [optional]="false">
                <ng-template cdkStepLabel>
                  <span class="number">1.</span>
                  <span>Project Information</span>
                </ng-template>
                <section *ngIf="cdkStepper.selectedIndex === 0">
                  <!-- Ensure the form is properly closed and structured -->
                  <form [formGroup]="firstFormGroup">
                    <div class="mb-3">
                      <label for="projectName">Project Name</label>
                      <input
                        formControlName="projectName"
                        class="form-control"
                        [ngClass]="{ 'is-invalid': firstFormGroup.get('projectName').invalid && firstFormGroup.get('projectName').touched }"
                        placeholder="Project name"
                      />
                      <div *ngIf="firstFormGroup.get('projectName').invalid && firstFormGroup.get('projectName').touched" class="text-danger">
                        Project name is required.
                      </div>
                    </div>

                    <div class="mb-3">
                      <label for="projectDescription">Project Description</label>
                      <textarea
                        formControlName="projectDescription"
                        class="form-control"
                        placeholder="Project description"
                      ></textarea>
                      <div *ngIf="firstFormGroup.get('projectDescription').invalid && firstFormGroup.get('projectDescription').touched" class="text-danger">
                        Project description is required.
                      </div>
                    </div>

                    <ul class="list-inline wizard d-flex justify-content-end">
                      <li class="next list-inline-item"><button class="btn btn-primary" cdkStepperNext [disabled]="!firstFormGroup.valid">Next</button></li>
                    </ul>
                  </form>
                </section>
              </cdk-step>

              <!-- Step 2: Timeline and Details -->
              <cdk-step>
                <ng-template cdkStepLabel>
                  <span class="number">2.</span>
                  <span>Timeline and Details</span>
                </ng-template>
                <section *ngIf="cdkStepper.selectedIndex === 1">
                  <form [formGroup]="secondFormGroup">
                    <div class="mb-3">
                      <label for="startDate">Start Date</label>
                      <input
                        formControlName="startDate"
                        type="date"
                        class="form-control"
                      />
                      <div *ngIf="secondFormGroup.get('startDate').invalid && secondFormGroup.get('startDate').touched" class="text-danger">
                        Start date is required.
                      </div>
                    </div>

                    <div class="mb-3">
                      <label for="endTime">End Time</label>
                      <input
                        formControlName="endTime"
                        type="date"
                        class="form-control"
                      />
                      <div *ngIf="secondFormGroup.get('endTime').invalid && secondFormGroup.get('endTime').touched" class="text-danger">
                        End time is required.
                      </div>
                    </div>

                    <div class="mb-3">
                      <label for="price">Price</label>
                      <input
                        formControlName="price"
                        type="number"
                        class="form-control"
                      />
                      <div *ngIf="secondFormGroup.get('price').invalid && secondFormGroup.get('price').touched" class="text-danger">
                        Price is required.
                      </div>
                    </div>

                    <ul class="list-inline wizard d-flex justify-content-end">
                      <li class="previous list-inline-item"><button class="btn btn-primary" cdkStepperPrevious>Previous</button></li>
                      <li class="next list-inline-item"><button class="btn btn-primary" cdkStepperNext [disabled]="!secondFormGroup.valid">Next</button></li>
                    </ul>
                  </form>
                </section>
              </cdk-step>

              <!-- Step 3: Team Members -->
              <cdk-step>
                <ng-template cdkStepLabel>
                  <span class="number">3.</span>
                  <span>Team Members</span>
                </ng-template>
                <section *ngIf="cdkStepper.selectedIndex === 2">
                  <form [formGroup]="thirdFormGroup">
                    <div class="mb-3">
                      <label for="teamName">Team Name</label>
                      <input
                        formControlName="teamName"
                        type="text"
                        class="form-control"
                        placeholder="Team Name"
                      />
                    </div>

                    <div class="mb-3">
                      <mat-label>Sélectionner un membre d'équipe</mat-label>
                      <input
                        type="text"
                        matInput
                        [formControl]="searchControl"
                        [matAutocomplete]="auto"
                        class="form-control"
                      />
                      <mat-autocomplete #auto="matAutocomplete" (optionSelected)="onUserSelected($event)">
                        <mat-option *ngFor="let user of filteredUsers" [value]="user.userId">
                          {{ user.firstName }} {{ user.lastName }}
                        </mat-option>
                      </mat-autocomplete>
                    </div>

                    <!-- Assign roles to team members -->
                    <div class="mb-3">
                      <h5>Assign Roles to Team Members</h5>
                      <ul>
                        <li *ngFor="let member of selectedTeamMembers" style="display: flex; align-items: center;">
                          {{ member.firstName }} {{ member.lastName }}
                          <input
                            type="text"
                            class="form-control" style="width: 50%; margin-left: 10px;"
                            (input)="updateTeamMemberRole(member.userId, $event.target.value)"
                            placeholder="Assign role"
                          />
                        </li>
                      </ul>
                    </div>

                    <ul class="list-inline wizard d-flex justify-content-end">
                      <li class="previous list-inline-item"><button class="btn btn-primary" cdkStepperPrevious>Previous</button></li>
                      <li class="next list-inline-item"><button class="btn btn-primary" cdkStepperNext [disabled]="!thirdFormGroup.valid">Next</button></li>
                    </ul>
                  </form>
                </section>
              </cdk-step>

              <!-- Step 4: Confirmation -->
              <cdk-step>
                <ng-template cdkStepLabel>
                  <span class="number">4.</span>
                  <span>Confirmation</span>
                </ng-template>
                <section *ngIf="cdkStepper.selectedIndex === 3">
                  <ul class="list-inline wizard d-flex justify-content-end">
                    <li class="previous list-inline-item"><button class="btn btn-primary" cdkStepperPrevious>Previous</button></li>
                    <li class="next list-inline-item"><button class="btn btn-primary" (click)="submitProject()">Submit</button></li>
                  </ul>
                </section>
              </cdk-step>

            </ng-stepper>
          </div>
        </div>
      </div>
    </div>
  </div>
</div>


